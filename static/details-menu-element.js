class e extends HTMLElement{constructor(){super()}get preload(){return this.hasAttribute("preload")}set preload(e){e?this.setAttribute("preload",""):this.removeAttribute("preload")}get src(){return this.getAttribute("src")||""}set src(e){this.setAttribute("src",e)}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","menu");const e=this.parentElement;if(!e)return;const s=e.querySelector("summary");s&&(s.setAttribute("aria-haspopup","menu"),s.hasAttribute("role")||s.setAttribute("role","button")),e.addEventListener("click",u),e.addEventListener("change",u),e.addEventListener("keydown",l),e.addEventListener("toggle",n,{once:!0}),e.addEventListener("toggle",o),this.preload&&e.addEventListener("mouseover",n,{once:!0});const i=[r(e)];t.set(this,{details:e,subscriptions:i,loaded:!1})}disconnectedCallback(){const e=t.get(this);if(!e)return;t.delete(this);const r=e.details,s=e.subscriptions;for(const e of s)e.unsubscribe();r.removeEventListener("click",u),r.removeEventListener("change",u),r.removeEventListener("keydown",l),r.removeEventListener("toggle",n,{once:!0}),r.removeEventListener("toggle",o),r.removeEventListener("mouseover",n,{once:!0})}}const t=new WeakMap;function n(e){const n=e.currentTarget;if(!(n instanceof Element))return;const r=n.querySelector("details-menu");if(!r)return;const o=r.getAttribute("src");if(!o)return;const i=t.get(r);if(!i)return;if(i.loaded)return;i.loaded=!0;const c=r.querySelector("include-fragment");c&&!c.hasAttribute("src")&&(c.addEventListener("loadend",()=>s(n)),c.setAttribute("src",o))}function r(e){let t=!1;const n=()=>t=!0,r=()=>t=!1,o=()=>{e.hasAttribute("open")&&(s(e)||t||function(e){const t=document.activeElement;if(t&&d(t)&&e.contains(t))return;const n=i(e,!0);n&&n.focus()}(e))};return e.addEventListener("mousedown",n),e.addEventListener("keydown",r),e.addEventListener("toggle",o),{unsubscribe:()=>{e.removeEventListener("mousedown",n),e.removeEventListener("keydown",r),e.removeEventListener("toggle",o)}}}function o(e){const t=e.currentTarget;if(t instanceof Element&&t.hasAttribute("open"))for(const e of document.querySelectorAll("details[open] > details-menu")){const n=e.closest("details");n&&n!==t&&!n.contains(t)&&n.removeAttribute("open")}}function s(e){if(!e.hasAttribute("open"))return!1;const t=e.querySelector("[autofocus]");return!!t&&(t.focus(),!0)}function i(e,t){const n=Array.from(e.querySelectorAll('[role^="menuitem"]:not([hidden]):not([disabled]):not([aria-disabled="true"])')),r=document.activeElement,o=n.indexOf(r),s=t?n[o+1]:n[o-1],i=t?n[0]:n[n.length-1];return s||i}const c=navigator.userAgent.match(/Macintosh/);function u(e){const t=e.target;if(!(t instanceof Element))return;const n=e.currentTarget;if(n instanceof Element&&t.closest("details")===n)if("click"===e.type){const e=t.closest('[role="menuitem"], [role="menuitemradio"]'),r=e&&"LABEL"===e.tagName&&e.querySelector("input");e&&!r&&a(e,n)}else if("change"===e.type){const e=t.closest('[role="menuitemradio"], [role="menuitemcheckbox"]');e&&a(e,n)}}function a(e,t){if(e.hasAttribute("disabled")||"true"===e.getAttribute("aria-disabled"))return;const n=e.closest("details-menu");n&&n.dispatchEvent(new CustomEvent("details-menu-select",{cancelable:!0,detail:{relatedTarget:e}}))&&(!function(e,t){const n=t.querySelector("[data-menu-button]");if(!n)return;const r=function(e){if(!e)return null;const t=e.hasAttribute("data-menu-button-text")?e:e.querySelector("[data-menu-button-text]");return t?t.getAttribute("data-menu-button-text")||t.textContent:null}(e);if(r)n.textContent=r;else{const t=function(e){if(!e)return null;const t=e.hasAttribute("data-menu-button-contents")?e:e.querySelector("[data-menu-button-contents]");return t?t.innerHTML:null}(e);t&&(n.innerHTML=t)}}(e,t),function(e,t){for(const n of t.querySelectorAll('[role="menuitemradio"], [role="menuitemcheckbox"]')){const t=n.querySelector('input[type="radio"], input[type="checkbox"]');let r=n===e;t instanceof HTMLInputElement&&(r=t.indeterminate?"mixed":t.checked),n.setAttribute("aria-checked",r.toString())}}(e,t),"menuitemcheckbox"!==e.getAttribute("role")&&m(t),n.dispatchEvent(new CustomEvent("details-menu-selected",{detail:{relatedTarget:e}})))}function l(e){const t=e.currentTarget;if(!(t instanceof Element))return;const n=e.target instanceof Element&&"SUMMARY"===e.target.tagName;if(!t.querySelector("details[open]"))switch(e.key){case"Escape":t.hasAttribute("open")&&(m(t),e.preventDefault(),e.stopPropagation());break;case"ArrowDown":{n&&!t.hasAttribute("open")&&t.setAttribute("open","");const r=i(t,!0);r&&r.focus(),e.preventDefault()}break;case"ArrowUp":{n&&!t.hasAttribute("open")&&t.setAttribute("open","");const r=i(t,!1);r&&r.focus(),e.preventDefault()}break;case"n":if(c&&e.ctrlKey){const n=i(t,!0);n&&n.focus(),e.preventDefault()}break;case"p":if(c&&e.ctrlKey){const n=i(t,!1);n&&n.focus(),e.preventDefault()}break;case" ":case"Enter":{const n=document.activeElement;n&&d(n)&&n.closest("details")===t&&(e.preventDefault(),e.stopPropagation(),n.click())}}}function d(e){const t=e.getAttribute("role");return"menuitem"===t||"menuitemcheckbox"===t||"menuitemradio"===t}function m(e){e.removeAttribute("open");const t=e.querySelector("summary");t&&t.focus()}window.customElements.get("details-menu")||(window.DetailsMenuElement=e,window.customElements.define("details-menu",e));
//# sourceMappingURL=details-menu-element.js.map
